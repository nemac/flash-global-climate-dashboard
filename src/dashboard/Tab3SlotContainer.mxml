<?xml version="1.0" encoding="utf-8"?>
<dashboard:TabContainer
		 xmlns:fx="http://ns.adobe.com/mxml/2009" 
		 xmlns:s="library://ns.adobe.com/flex/spark" 
		 xmlns:mx="library://ns.adobe.com/flex/mx" 
		 xmlns:local="*"
		 xmlns:multigraph="multigraph.*"
		 verticalGap="10" width="100%" xmlns:dashboard="dashboard.*">
	<fx:Declarations>
		<!-- Place non-visual elements (e.g., services, value objects) here -->
	</fx:Declarations>
	
	<fx:Script>
		<![CDATA[
			import flash.filters.DropShadowFilter;
			
			import multigraph.Axis;
			import multigraph.AxisEvent;
			import multigraph.Multigraph;
			import multigraph.format.DateFormatter;
			
			import mx.core.IUIComponent;
			import mx.core.IVisualElement;
			import mx.events.DragEvent;
			import mx.events.FlexEvent;
			import mx.managers.DragManager;
			
			import spark.components.Button;
			import spark.filters.GlowFilter;
			import spark.layouts.VerticalLayout;
			import spark.skins.spark.PanelSkin;
			
			private var expandedGraphContainerCount:int = 0;

			override protected function createChildren():void {
				super.createChildren();
				
				_numberOfExpandedSlots = 3;
				_totalNumberOfSlots    = 10;

				
				//
				// Create the graph "slots".  Each slot is an instance of a GraphSlot object, which
				// is just a spark Group container that serves as a place where a GraphContainer
				// can be added (either in expanded or collapsed state).  The GraphSlot object also
				// stores an "index" which indicates which slot it is in the list of slots; our DRAG_DROP
				// event listener uses this index to determine which slot the graph being dragged
				// came from.
				//
				graphSlots = [];
				var g:GraphSlot;
				for (var i:int=0; i<_totalNumberOfSlots; ++i) {
					g = new GraphSlot(i);
					g.width = _graphWidth;
					if (i < this._numberOfExpandedSlots) {
						g.addEventListener(DragEvent.DRAG_ENTER,
							function (e:DragEvent):void {
								DragManager.acceptDragDrop(e.currentTarget as IUIComponent);
								DragManager.showFeedback(DragManager.COPY);
								((e.currentTarget as GraphSlot).getChildAt(0) as GraphContainer).alpha = 0.2;
								((e.currentTarget as GraphSlot).getChildAt(0) as GraphContainer).alpha = .5;
							});
						g.addEventListener(DragEvent.DRAG_EXIT,
							function (e:DragEvent):void {
								((e.currentTarget as GraphSlot).getChildAt(0) as GraphContainer).alpha = 1;
							});
						g.addEventListener(DragEvent.DRAG_DROP,
							function (slotNumber:int):Function {	
								return function (e:DragEvent):void {
									swapGraphContainers((e.dragInitiator as GraphContainer).getSlotNumber(), slotNumber); 
								};
							}(i)
						);
						g.height = _graphHeight;
						expandedGraphContainer.addElementAt(g,expandedGraphContainerCount);
						++expandedGraphContainerCount;
					} else {
						g.height = _graphCollapsedHeight;
						collapsedGraphContainer.addElement(g);
					}
					graphSlots.push(g);
					
					//xAxis.leftPad = _leftPad;
				}
			}

			private function swapGraphContainers(aSlotNumber:int, bSlotNumber:int):void {
				var aSlot:GraphSlot = graphSlots[aSlotNumber];
				var bSlot:GraphSlot = graphSlots[bSlotNumber];
				var aGraphContainer:GraphContainer = graphSlots[aSlotNumber].getChildAt(0) as GraphContainer;
				var bGraphContainer:GraphContainer = graphSlots[bSlotNumber].getChildAt(0) as GraphContainer;
				if (aSlotNumber < this._numberOfExpandedSlots) {
					bGraphContainer.currentState = "expanded";
				} else {
					bGraphContainer.currentState = "collapsed";
					bGraphContainer.help.visible = false;
					bGraphContainer.collapsed_container.currentState = "up";
				}
				if (bSlotNumber < this._numberOfExpandedSlots) {
					aGraphContainer.currentState = "expanded";
				} else {
					aGraphContainer.currentState = "collapsed";
					aGraphContainer.collapsed_container.currentState = "up";
					aGraphContainer.help.visible = false;
				}
				aSlot.addElement(bGraphContainer);
				bSlot.addElement(aGraphContainer);
				aGraphContainer.alpha = 1;
				bGraphContainer.alpha = 1;
			}
			
			
		]]>
	</fx:Script>
	
    <!-- backgroundAlpha="1.0" backgroundColor="#00FF00" -->
    <s:SkinnableContainer id="leftSide" backgroundAlpha="0" width="50%">
<!--
      <s:Label y="5" text="Global Climate Dashboard" horizontalCenter="0"
               color="#FFFFFF"
               fontSize="24" fontWeight="bold"/>
-->
      <s:SkinnableContainer y="200" id="collapsedGraphContainer" backgroundAlpha="0" width="100%">
        <s:layout>
          <s:VerticalLayout horizontalAlign="center"/>
        </s:layout>
      </s:SkinnableContainer>
    </s:SkinnableContainer>


    <!-- backgroundAlpha="1.0" backgroundColor="#FF0000" -->
    <s:SkinnableContainer id="rightSide" backgroundAlpha="1" backgroundColor="#1d2a3c" width="50%" >

      <s:layout>
        <s:VerticalLayout horizontalAlign="center"/>
      </s:layout>




      <s:SkinnableContainer backgroundAlpha="0" width="425">
        <s:layout>
          <s:VerticalLayout horizontalAlign="right"/>
        </s:layout>
<!--
        <s:Label text="Drag to select time period" horizontalCenter="0" color="#cc9933" fontSize="10" fontWeight="bold"/>
-->
        <dashboard:TimeSlider id="timeslider"
                               minValue="{timeSliderMin}"
                               maxValue="{timeSliderMax}"
                               selectedMinValue="{timeSliderSelectedMin}"
                               selectedMaxValue="{timeSliderSelectedMax}"
                               labels="{timeSliderLabels}"
                               height="40" width="408"
                               change="sliderChange(event)"
                               />
      </s:SkinnableContainer>






      <s:SkinnableContainer width="425" height="20" backgroundAlpha=".0001">
        <s:BorderContainer id="container" cornerRadius="4" backgroundColor="#FFFFFF" width="100%" height="20" borderVisible="false" left="{_leftPad}">
          <!--
              ** NOTE: the x="4" value on the following multigraph is a trial-and-error fudge factor used to get the timeline to correctly line
              **       up with the other graphs.  If the size, position, or margins of the other graphs are changed, this will probably need
              **       to be adjusted.
          -->
          <multigraph:Multigraph id="timeline" mugl="{timelineMugl}" width="{container.width-2*GraphContainer.graphPadding}" x="4" height="20"/>
        </s:BorderContainer>	
      </s:SkinnableContainer>

      <s:SkinnableContainer id="expandedGraphContainer" left="5" right="5" top="0" bottom="0"
                            minHeight="350" backgroundAlpha="0">
        <s:layout>
          <s:VerticalLayout horizontalAlign="right"/>
        </s:layout>

      </s:SkinnableContainer>

    </s:SkinnableContainer>

</dashboard:TabContainer>
